config:
- matcher:
    require:
    - 'agent.product.(1)name="Mobile"'
    - 'IsNull[agent.product.(1)name="Mobile"^>]'
    - 'IsNull[agent.product.(1)name="Safari"]'
    extract:
    - 'AgentClass            :   50:"Browser Webview"'
    - 'AgentName             :   50:"UIWebView"'
    - 'AgentVersion          :   50:agent.product.(1)name="AppleWebKit"^.version'
    - 'WebviewAppName        :    1:"Unknown Webview App"'
    - 'WebviewAppVersion     :    1:"??"'

- matcher:
    require:
    - 'agent.product.(1)name="Mobile"'
    extract:
    - 'AgentClass            :   41:"Browser Webview"'
    - 'AgentName             :   41:"UIWebView"'
    - 'AgentVersion          :   41:agent.product.(1)name="AppleWebKit"^.version'
    - 'WebviewAppName        :    1:"Google Search App"'
    - 'WebviewAppVersion     :    1:agent.product.(1)name="GSA"^.version'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPad; CPU OS 7_1_1 like Mac OS X) AppleWebKit/537.51.2 (KHTML, like Gecko) GSA/5.1.42378 Mobile/11D201 Safari/9537.53'
    expected:
      DeviceClass                          : 'Tablet'
      DeviceName                           : 'Apple iPad'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '11D201'
      DeviceVersion                        : 'iPad'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '7.1.1'
      OperatingSystemNameVersion           : 'iOS 7.1.1'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '537.51.2'
      LayoutEngineVersionMajor             : '537'
      LayoutEngineNameVersion              : 'AppleWebKit 537.51.2'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 537'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'UIWebView'
      AgentVersion                         : '537.51.2'
      AgentVersionMajor                    : '537'
      AgentNameVersion                     : 'UIWebView 537.51.2'
      AgentNameVersionMajor                : 'UIWebView 537'
      WebviewAppName                       : 'Google Search App'
      WebviewAppNameVersionMajor           : 'Google Search App 5'
      WebviewAppVersion                    : '5.1.42378'
      WebviewAppVersionMajor               : '5'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPad; CPU OS 9_3_1 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) GSA/15.0.122066290 Mobile/13E238 Safari/600.1.4'
    expected:
      DeviceClass                          : 'Tablet'
      DeviceName                           : 'Apple iPad'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '13E238'
      DeviceVersion                        : 'iPad'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '9.3.1'
      OperatingSystemNameVersion           : 'iOS 9.3.1'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '600.1.4'
      LayoutEngineVersionMajor             : '600'
      LayoutEngineNameVersion              : 'AppleWebKit 600.1.4'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 600'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'UIWebView'
      AgentVersion                         : '600.1.4'
      AgentVersionMajor                    : '600'
      AgentNameVersion                     : 'UIWebView 600.1.4'
      AgentNameVersionMajor                : 'UIWebView 600'
      WebviewAppName                       : 'Google Search App'
      WebviewAppNameVersionMajor           : 'Google Search App 15'
      WebviewAppVersion                    : '15.0.122066290'
      WebviewAppVersionMajor               : '15'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPad; CPU OS 11_1_1 like Mac OS X) AppleWebKit/604.1.34 (KHTML, like Gecko) GSA/38.0.172903409 Mobile/15B150 Safari/604.1'
    expected:
      DeviceClass                          : 'Tablet'
      DeviceName                           : 'Apple iPad'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '15B150'
      DeviceVersion                        : 'iPad'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '11.1.1'
      OperatingSystemNameVersion           : 'iOS 11.1.1'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '604.1.34'
      LayoutEngineVersionMajor             : '604'
      LayoutEngineNameVersion              : 'AppleWebKit 604.1.34'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 604'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'UIWebView'
      AgentVersion                         : '604.1.34'
      AgentVersionMajor                    : '604'
      AgentNameVersion                     : 'UIWebView 604.1.34'
      AgentNameVersionMajor                : 'UIWebView 604'
      WebviewAppName                       : 'Google Search App'
      WebviewAppNameVersionMajor           : 'Google Search App 38'
      WebviewAppVersion                    : '38.0.172903409'
      WebviewAppVersionMajor               : '38'


# NOTE: According to https://mobiforge.com/research-analysis/webviews-and-user-agent-strings my current rules are incorrect
# I suspect the author of that website got these two mixed up (because then they match perfectly with the specifications from Apple)
#Safari for iOS User-Agent string
#  - test:
#      input:
#        user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 8_2 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Version/8.0 Mobile/12D508'
#      expected:
#        DeviceClass                          : 'Phone'
#        DeviceName                           : 'Apple iPhone'
#        DeviceBrand                          : 'Apple'
#        DeviceFirmwareVersion                : '12D508'
#        DeviceVersion                        : 'iPhone'
#        OperatingSystemClass                 : 'Mobile'
#        OperatingSystemName                  : 'iOS'
#        OperatingSystemVersion               : '8.2'
#        OperatingSystemNameVersion           : 'iOS 8.2'
#        LayoutEngineClass                    : 'Browser'
#        LayoutEngineName                     : 'AppleWebKit'
#        LayoutEngineVersion                  : '600.1.4'
#        LayoutEngineVersionMajor             : '600'
#        LayoutEngineNameVersion              : 'AppleWebKit 600.1.4'
#        LayoutEngineNameVersionMajor         : 'AppleWebKit 600'
#        AgentClass                           : 'Browser Webview'
#        AgentName                            : 'UIWebView'
#        AgentVersion                         : '600.1.4'
#        AgentVersionMajor                    : '600'
#        AgentNameVersion                     : 'UIWebView 600.1.4'
#        AgentNameVersionMajor                : 'UIWebView 600'
#        WebviewAppName                       : 'Unknown Webview App'
#        WebviewAppVersion                    : '??'
#
##Whatsapp for iOS User-Agent string
#  - test:
#      input:
#        user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 8_2 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Version/8.0 Mobile/12D508 Safari/600.1.4'
#      expected:
#        DeviceClass                          : 'Phone'
#        DeviceName                           : 'Apple iPhone'
#        DeviceBrand                          : 'Apple'
#        DeviceFirmwareVersion                : '12D508'
#        DeviceVersion                        : 'iPhone'
#        OperatingSystemClass                 : 'Mobile'
#        OperatingSystemName                  : 'iOS'
#        OperatingSystemVersion               : '8.2'
#        OperatingSystemNameVersion           : 'iOS 8.2'
#        LayoutEngineClass                    : 'Browser'
#        LayoutEngineName                     : 'AppleWebKit'
#        LayoutEngineVersion                  : '600.1.4'
#        LayoutEngineVersionMajor             : '600'
#        LayoutEngineNameVersion              : 'AppleWebKit 600.1.4'
#        LayoutEngineNameVersionMajor         : 'AppleWebKit 600'
#        AgentClass                           : 'Browser'
#        AgentName                            : 'Safari'
#        AgentVersion                         : '8.0'
#        AgentVersionMajor                    : '8'
#        AgentNameVersion                     : 'Safari 8.0'
#        AgentNameVersionMajor                : 'Safari 8'

